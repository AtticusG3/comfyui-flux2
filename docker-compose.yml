services:
  comfyui:
    container_name: comfyui
    image: ghcr.io/atticusg3/comfyui-flux2:main
    restart: unless-stopped
    ports:
      - "8188:8188"
    volumes:
      - comfyui_data:/app/ComfyUI
      - "./data/models:/app/ComfyUI/models"
      - "./data/input:/app/ComfyUI/input"
      - "./data/output:/app/ComfyUI/output"
      - "./data/workflows:/app/ComfyUI/user/default/workflows"
    environment:
      - TZ=${TZ:-UTC}
      - CLI_ARGS=
      - HF_TOKEN=${HF_TOKEN}
      - CIVITAI_API_KEY=${CIVITAI_API_KEY}
      - LOW_VRAM=${LOW_VRAM:-false}
      - MODELS_DOWNLOAD=${MODELS_DOWNLOAD:-klein-distilled}
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ['0']
              capabilities: [gpu]

volumes:
  comfyui_data: